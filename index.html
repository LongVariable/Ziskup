<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ziskup</title>
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<link rel="stylesheet" href="css/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
</head>
<body>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-logo">Ziskup<span>.</span></div>

    <div class="sb-section">Navigace</div>
    <button class="sb-btn active" id="navDash" onclick="showView('dashboard')">
      <span class="sb-dot"></span> Dashboard
    </button>
    <button class="sb-btn" id="navMonth" onclick="showView('month')">
      <span class="sb-dot"></span> Měsíční přehled
    </button>
    <button class="sb-btn" id="navTemplate" onclick="openTemplate()">
      <span class="sb-dot sb-dot-tmpl"></span> Vzor měsíce
    </button>

    <div class="sb-section" style="margin-top:8px">Měsíce</div>
    <div class="sb-months" id="sbMonths"></div>
    <button class="sb-new-month" onclick="openNewMonth()">+ Nový měsíc</button>

    <div class="sb-footer">
      <button class="sb-footer-btn" onclick="exportData()">Export JSON</button>
      <label class="sb-footer-btn">Import JSON
        <input type="file" accept=".json" id="importFile" onchange="importData(event)">
      </label>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">

    <!-- WELCOME -->
    <div id="viewWelcome" class="welcome">
      <div class="welcome-title">Ziskup<span style="color:var(--blue)">.</span></div>
      <p>Vyber měsíc vlevo nebo vytvoř nový.</p>
    </div>

    <!-- ══════════════ DASHBOARD ══════════════ -->
    <div class="view" id="viewDashboard">

      <div class="view-header">
        <div>
          <div class="page-title">Dashboard</div>
          <div class="page-subtitle">Souhrnný přehled za vybrané období</div>
        </div>
      </div>

      <!-- Filter -->
      <div class="dash-filter">
        <span class="filter-label">Období:</span>
        <select class="filter-select" id="dashFromY"></select>
        <select class="filter-select" id="dashFromM"></select>
        <span class="filter-sep">—</span>
        <select class="filter-select" id="dashToY"></select>
        <select class="filter-select" id="dashToM"></select>
        <button class="filter-btn" onclick="renderDashboard()">Zobrazit</button>
        <button class="filter-btn ghost" onclick="dashCurrentYear()">Tento rok</button>
        <button class="filter-btn ghost" onclick="dashAllTime()">Vše</button>
        <span class="filter-count" id="dPeriodCount"></span>
      </div>

      <!-- Summary cards -->
      <div class="cards cards-3">
        <div class="card accent-green">
          <div class="card-label">Celkové příjmy</div>
          <div class="card-value green" id="dIncome">0 Kč</div>
          <div class="card-sub" id="dIncomeSub"></div>
        </div>
        <div class="card accent-red">
          <div class="card-label">Celkové výdaje</div>
          <div class="card-value red" id="dExpense">0 Kč</div>
          <div class="card-sub" id="dExpenseSub"></div>
        </div>
        <div class="card accent-bal">
          <div class="card-label">Bilance</div>
          <div class="card-value yellow" id="dBalance">0 Kč</div>
          <div class="card-sub" id="dBalanceSub"></div>
        </div>
      </div>


      <!-- Grafy příjmy/výdaje podle kategorií -->
      <div class="charts-row">
        <div class="chart-block">
          <div class="chart-block-head">
            <span class="chart-block-title">Příjmy</span>
            <div class="chart-toggle" id="incToggle">
              <button class="ctbtn active" onclick="setChartMode('inc','cat')">Kategorie</button>
              <button class="ctbtn" onclick="setChartMode('inc','item')">Položky</button>
            </div>
          </div>
          <div class="chart-wrap"><canvas id="chartIncomeCat"></canvas></div>
        </div>
        <div class="chart-block">
          <div class="chart-block-head">
            <span class="chart-block-title">Výdaje</span>
            <div class="chart-toggle" id="expToggle">
              <button class="ctbtn active" onclick="setChartMode('exp','cat')">Kategorie</button>
              <button class="ctbtn" onclick="setChartMode('exp','item')">Položky</button>
            </div>
          </div>
          <div class="chart-wrap"><canvas id="chartExpenseCat"></canvas></div>
        </div>
      </div>

      <!-- Bilance po měsících + rozpad výdajů -->
      <div class="two-col">
        <div class="chart-block">
          <div class="chart-block-title">Bilance po měsících</div>
          <div class="chart-wrap"><canvas id="chartBalLine"></canvas></div>
        </div>
        <div class="chart-block">
          <div class="chart-block-title">Výdaje po kategoriích — rozpad</div>
          <div id="catBreakdown" class="cat-breakdown"></div>
        </div>
      </div>

      <!-- Tabulky + highlight karty vedle -->
      <div class="dash-bottom">
        <div class="table-block">
          <div class="table-block-header">
            <span class="table-block-title t-green">Příjmy</span>
            <span class="table-block-sum green" id="dTableIncSum">0 Kč</span>
          </div>
          <table class="ft">
            <thead><tr><th>Položka</th><th>Kategorie</th><th class="tr">Částka</th></tr></thead>
            <tbody id="dTableInc"></tbody>
          </table>
        </div>
        <div class="table-block">
          <div class="table-block-header">
            <span class="table-block-title t-red">Výdaje</span>
            <span class="table-block-sum red" id="dTableExpSum">0 Kč</span>
          </div>
          <table class="ft">
            <thead><tr><th>Položka</th><th>Kategorie</th><th class="tr">Částka</th></tr></thead>
            <tbody id="dTableExp"></tbody>
          </table>
        </div>
        <div class="dash-highlights">
          <div class="card accent-green">
            <div class="card-label">Nejvyšší příjem</div>
            <div class="card-value green" id="dTopInc">—</div>
            <div class="card-sub" id="dTopIncName"></div>
          </div>
          <div class="card accent-red">
            <div class="card-label">Největší výdaj</div>
            <div class="card-value red" id="dTopExp">—</div>
            <div class="card-sub" id="dTopExpName"></div>
          </div>
        </div>
      </div>

    </div>

    <!-- ══════════════ MONTH VIEW ══════════════ -->
    <div class="view" id="viewMonth">

      <div class="view-header">
        <div><div class="page-title" id="mTitle">—</div></div>
        <button class="filter-btn ghost small" onclick="addCustomCategory()">+ Vlastní kategorie</button>
      </div>

      <!-- Karty -->
      <div class="cards cards-3">
        <div class="card accent-green">
          <div class="card-label">Příjmy</div>
          <div class="card-value green" id="mIncome">0 Kč</div>
        </div>
        <div class="card accent-red">
          <div class="card-label">Výdaje</div>
          <div class="card-value red" id="mExpense">0 Kč</div>
        </div>
        <div class="card accent-bal">
          <div class="card-label">Bilance</div>
          <div class="card-value yellow" id="mBalance">0 Kč</div>
        </div>
      </div>

      <!-- Podtabulky -->
      <div class="sub-bar">
        <div class="sub-label">Podtabulky kategorie</div>
        <div class="search-wrap">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          <input type="text" class="search-input" id="searchInput" placeholder="Hledat v transakcích…" oninput="onSearch(this.value)">
          <button class="search-clear" id="searchClear" onclick="clearSearch()" title="Zrušit">×</button>
        </div>
      </div>
      <div class="sub-grid" id="subGrid"></div>

    </div>

  </main>
</div>

<!-- MODAL -->
<div class="modal-bg" id="modalMonth">
  <div class="modal">
    <div class="modal-head">Nový měsíc</div>
    <div class="modal-body">
      <label>Rok</label>
      <input type="number" id="mYear" min="2000" max="2100">
      <label>Měsíc</label>
      <select id="mMonth">
        <option value="1">Leden</option><option value="2">Únor</option>
        <option value="3">Březen</option><option value="4">Duben</option>
        <option value="5">Květen</option><option value="6">Červen</option>
        <option value="7">Červenec</option><option value="8">Srpen</option>
        <option value="9">Září</option><option value="10">Říjen</option>
        <option value="11">Listopad</option><option value="12">Prosinec</option>
      </select>
    </div>
    <div class="modal-foot">
      <button class="btn-ghost" onclick="closeModal('modalMonth')">Zrušit</button>
      <button class="btn-primary" onclick="confirmNewMonth()">Vytvořit</button>
    </div>
  </div>
</div>

<!-- CONFIRM MODAL -->
<div class="modal-bg" id="modalConfirm">
  <div class="modal">
    <div class="modal-head" id="confirmTitle">Potvrzení</div>
    <div class="modal-body">
      <p id="confirmMsg" style="color:var(--text2);font-size:0.85rem;line-height:1.5"></p>
    </div>
    <div class="modal-foot">
      <button class="btn-ghost" onclick="closeModal('modalConfirm')">Ne</button>
      <button class="btn-primary btn-danger" onclick="confirmYes()">Ano</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- MOBILE BOTTOM NAV -->
<nav class="mob-nav">
  <div class="mob-nav-inner">
    <button class="mob-nav-btn active" id="mobNavDash" onclick="mobNav('dashboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/>
        <rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/>
      </svg>
      Dashboard
    </button>
    <button class="mob-nav-btn" id="mobNavMonth" onclick="mobNav('month')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
      Měsíc
    </button>
    <button class="mob-nav-btn" id="mobNavMenu" onclick="toggleSidebar()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
      Menu
    </button>
  </div>
</nav>

<script src="js/app.js"></script>
</body>
</html>
